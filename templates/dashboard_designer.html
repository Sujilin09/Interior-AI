{% extends "layout_designer.html" %}

{% block title %}Dashboard{% endblock %}

{% block head %}
<style>
/* --- Performance Overview Grid --- */
.overview-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}
.overview-grid h3 { font-size: 1.5rem; margin: 0; }
.overview-grid small { color: #666; }

/* --- SINGLE Portfolio Slider --- */
.portfolio-scroll-grid {
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    padding-bottom: 1rem;
    scroll-behavior: smooth;
}
.portfolio-scroll-grid::-webkit-scrollbar { height: 8px; }
.portfolio-scroll-grid::-webkit-scrollbar-track { background: #f1f1f1; }
.portfolio-scroll-grid::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }

.portfolio-item {
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1rem;
    min-width: 220px;
    background: #ffffff;
}
.portfolio-item img {
    width: 100%;
    height: 130px;
    object-fit: cover;
    border-radius: 4px;
}
.portfolio-item p { margin: 10px 0 3px 0; font-weight: bold; }
.portfolio-item small { color: #6b7280; }

/* Leads slider untouched */
.leads-slider {
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    padding-bottom: 1.5rem;
    scroll-behavior: smooth;
}
.leads-slider::-webkit-scrollbar { height: 8px; }
.leads-slider::-webkit-scrollbar-thumb { background: #cbd5e0; }

.lead-card {
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 1.25rem;
    background: #fff;
    min-width: 280px;
    flex: 0 0 auto;
}
.lead-avatar {
    width: 40px; height: 40px;
    background: #e6fffa; color: #059669;
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    font-weight: bold;
}

.btn-green {
    background-color: #059669;
    color: white;
    padding: 8px 15px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
}
.btn-green:hover { background-color: #046c4e; }

/* Dimmed background overlay */
#addProjectModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.55); /* darker than before */
    backdrop-filter: blur(3px); /* smooth blur effect */
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

/* Modal box */
.modal-box {
    background: #ffffff; /* FULL WHITE */
    width: 450px;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    animation: modalFadeIn 0.25s ease-out;
}

/* Fade animation */
@keyframes modalFadeIn {
    from { opacity: 0; transform: translateY(-15px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Inputs */
.modal-box label {
    font-weight: 600;
    margin-bottom: 5px;
    display: block;
}

.modal-box input,
.modal-box textarea {
    margin-bottom: 18px;
}


/* Buttons */
.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.btn-cancel {
    background: #e5e7eb;
    border: none;
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
}

.btn-green {
    background: #059669;
    color: white;
    border: none;
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
}

</style>
{% endblock %}

{% block content %}
<main class="main-content">

    <!-- HEADER -->
    <div class="section-header" style="display:flex; justify-content:space-between; align-items:center;">
        <h1>Welcome, {{ designer.designer_name if designer else "Designer" }}!</h1>

        <!-- Only ONE Add Project button -->
        <a id="openAddProjectModal" class="btn-green" style="text-decoration:none; cursor:pointer;">
            + Add New Project
        </a>

    </div>

      <!-- Performance Overview -->
    <div class="card" style="margin-bottom:1.5rem;">
      <h2>Performance Overview</h2>
      <div class="overview-grid" style="margin-top:12px;">
        <div>
          <p style="color:#6b7280;">Total Projects</p>
          <h3>{{ total_projects or 0 }}</h3>
          <small>Across all categories</small>
        </div>
        <div>
          <p style="color:#6b7280;">This Month's Bookings</p>
          <h3>{{ monthly_bookings or 0 }}</h3>
          <small>{{ current_month or "" }}</small>
        </div>
        <div>
          <p style="color:#6b7280;">Average Rating</p>
          <h3>{{ avg_rating or 0 }} <span style="color: gold;">â˜…</span></h3>
          <small>Based on {{ total_reviews or 0 }} reviews</small>
        </div>
      </div>
    </div>


    <!-- =============================== -->
    <!--   MY PORTFOLIO (ONLY SLIDER)   -->
    <!-- =============================== -->
    <div class="card" style="margin-top:1.5rem;">
        <h3>My Portfolio</h3>

        <div class="portfolio-scroll-grid">
            {% if portfolio %}
                {% for item in portfolio %}
                <div class="portfolio-item">
                    <img src="{{ item.image_url or '/static/images/placeholder.jpg' }}">
                    <p>{{ item.project_title or "Untitled" }}</p>
                    <small>{{ item.room_type or "" }}</small>
                </div>
                {% endfor %}
            {% else %}
                <p style="color:#888;">No portfolio items uploaded yet.</p>
            {% endif %}
        </div>
    </div>

    <!-- =============================== -->
    <!-- LEAD RECOMMENDATIONS (UNCHANGED) -->
    <!-- =============================== -->
    <section class="card" style="margin-top:1.5rem;">
        <h2 style="display:flex; align-items:center; gap:10px;">
            <i class="bx bx-target-lock" style="color:#059669;"></i> AI Lead Recommendations
        </h2>

        <p style="color:#666;">Matched based on your location ({{ designer.location if designer else "N/A" }})</p>

        <div class="leads-slider">
            {% for lead in recommended_leads %}
            <div class="lead-card">
                <div style="display:flex; justify-content:space-between;">
                    <div style="display:flex; gap:10px;">
                        <div class="lead-avatar">{{ lead.name[0] }}</div>
                        <div>
                            <h4>{{ lead.name }}</h4>
                            <small>{{ lead.location }}</small>
                        </div>
                    </div>
                    <span class="match-score">{{ lead.match_score }}%</span>
                </div>

<<<<<<< HEAD
                <button class="btn-green" style="margin-top:10px;">Connect</button>
=======
                <button class="btn-green" style="margin-top:10px;" onclick="alert('Feature upcoming soon!')">Connect</button>
>>>>>>> eadb74adbd134c76e79ec0330bcb97cc2c0aed3a
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- =============================== -->
    <!-- ADD PROJECT MODAL (unchanged)   -->
    <!-- =============================== -->

    <!-- Modal (hidden by default) -->
    <div id="addProjectModal" 
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
                background:rgba(0,0,0,0.55); backdrop-filter:blur(3px);
                justify-content:center; align-items:center; z-index:9999;">

      <div style="background:white; padding:30px; border-radius:12px;
                  width:650px; max-width:90%; 
                  max-height:85vh; overflow-y:auto;
                  box-shadow:0 10px 30px rgba(0,0,0,0.25);">

          <h2 style="margin-top:0; margin-bottom:15px; font-size:22px; font-weight:700;">
              Add New Project
          </h2>

          <form id="addProjectForm" enctype="multipart/form-data" style="font-size:15px;">

            <div class="form-group" style="margin-bottom:18px;">
              <label style="font-weight:600;">Upload Image:</label>
              <input type="file" name="image_file" id="image_file" accept="image/*" 
                    style="width:100%; padding:10px; border-radius:6px; 
                            border:1px solid #ccc;">
            </div>

            <div class="form-group" style="margin-bottom:18px;">
              <label style="font-weight:600;">Or paste image URL (optional):</label>
              <input type="url" name="image_url" id="image_url" placeholder="Paste image link here"
                    style="width:100%; padding:10px; border-radius:6px; 
                            border:1px solid #ccc;">
            </div>

            <div class="form-group" style="margin-bottom:18px;">
              <label style="font-weight:600;">Project Title:</label>
              <input type="text" id="project_title" name="project_title" required 
                    placeholder="e.g. Modern Living Room"
                    style="width:100%; padding:10px; border-radius:6px; 
                            border:1px solid #ccc;">
            </div>

            <div class="form-group" style="margin-bottom:18px;">
              <label style="font-weight:600;">Project Description:</label>
              <textarea id="project_description" name="project_description" rows="4"
                        placeholder="Short project summary"
                        style="width:100%; padding:10px; border-radius:6px; 
                              border:1px solid #ccc;"></textarea>
            </div>

            <div class="form-group" style="margin-bottom:18px;">
              <label style="font-weight:600;">Room Type:</label>
              <input type="text" id="room_type" name="room_type" required 
                    placeholder="e.g. Kitchen, Bedroom"
                    style="width:100%; padding:10px; border-radius:6px; 
                            border:1px solid #ccc;">
            </div>

            <div style="display:flex; justify-content:flex-end; gap:12px; margin-top:10px;">
              <button type="button" id="closeModal"
                      style="background:#e5e7eb; color:#111; border:none; 
                            padding:10px 16px; border-radius:6px; cursor:pointer;">
                  Cancel
              </button>

              <button type="submit"
                      style="background:#059669; color:white; border:none; 
                            padding:10px 20px; border-radius:6px; cursor:pointer;">
                  Add Project
              </button>
            </div>

          </form>

      </div>
    </div>



</main>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("addProjectModal");
    const openBtn = document.getElementById("openAddProjectModal");
    const closeBtn = document.getElementById("closeModal");

    openBtn.onclick = () => modal.style.display = "flex";
    closeBtn.onclick = () => modal.style.display = "none";

    window.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };

    // FORM SUBMIT HANDLER
    document.getElementById("addProjectForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        let formData = new FormData();
        formData.append("project_title", project_title.value);
        formData.append("project_description", project_description.value);
        formData.append("room_type", room_type.value);

        if (image_file.files[0]) formData.append("image_file", image_file.files[0]);
        else if (image_url.value.trim()) formData.append("image_url", image_url.value.trim());
        else return alert("Upload image or paste URL");

        const res = await fetch("/designer/portfolio/add", { method:"POST", body: formData });
        const data = await res.json();

        if (data.success) {
            alert("Project added!");

            const slider = document.querySelector(".portfolio-scroll-grid");
            const card = document.createElement("div");
            card.className = "portfolio-item";
            card.innerHTML = `
                <img src="${data.project.image_url}">
                <p>${data.project.project_title}</p>
                <small>${data.project.room_type}</small>
            `;
            slider.appendChild(card);

            modal.style.display = "none";
            document.getElementById("addProjectForm").reset();
        }
    });
});
</script>
{% endblock %}
