{% extends "layout_designer.html" %}

{% block title %}Dashboard{% endblock %}

{% block head %}
<style>
    /* --- Performance Overview Grid --- */
    .overview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
    }
    .overview-grid h3 { font-size: 1.5rem; margin: 0; }
    .overview-grid small { color: #666; }
    
    /* --- Portfolio Slider (Existing) --- */
    .portfolio-scroll-grid {
        display: flex;
        gap: 1.5rem;
        overflow-x: auto;
        padding-bottom: 1rem;
    }
    .portfolio-item {
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 1rem;
        min-width: 220px;
        background: #fdfdfd;
    }
    .portfolio-item img {
        width: 100%;
        height: 120px;
        object-fit: cover;
        border-radius: 4px;
        margin-bottom: 0.5rem;
    }
    .portfolio-item p { margin: 0.5rem 0 0 0; font-weight: bold; }
    .portfolio-item small { color: #6b7280; }

    /* --- NEW: Lead Recommendations Slider --- */
    .leads-slider {
        display: flex;
        gap: 1.5rem;
        overflow-x: auto; /* Enables horizontal scroll */
        padding-bottom: 1.5rem; /* Space for scrollbar */
        scroll-behavior: smooth;
    }
    /* Optional: Custom Scrollbar Styling */
    .leads-slider::-webkit-scrollbar { height: 8px; }
    .leads-slider::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
    .leads-slider::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }
    .leads-slider::-webkit-scrollbar-thumb:hover { background: #a0aec0; }

    .lead-card {
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 1.25rem;
        background: #fff;
        transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
        
        /* Slider Properties */
        min-width: 280px; /* Fixed width so they don't squish */
        flex: 0 0 auto;   /* Prevent shrinking */
    }
    .lead-card:hover {
        transform: translateY(-3px);
        border-color: #059669;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    .lead-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
    }
    .lead-avatar {
        width: 40px; height: 40px;
        background: #e6fffa; color: #059669;
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-weight: bold; font-size: 1.1rem;
    }
    .match-score {
        background: #059669; color: white;
        font-size: 0.75rem; padding: 4px 10px;
        border-radius: 99px; font-weight: 600;
    }
    .lead-tags {
        display: flex; flex-wrap: wrap; gap: 5px; margin: 12px 0;
        height: 55px; /* Fixed height to align buttons */
        overflow: hidden;
    }
    .lead-tag {
        background: #f7fafc; border: 1px solid #edf2f7;
        padding: 2px 8px; border-radius: 4px;
        font-size: 0.75rem; color: #4a5568;
    }
    .lead-meta {
        display: flex; justify-content: space-between;
        font-size: 0.85rem; color: #718096;
        border-top: 1px dashed #e2e8f0;
        padding-top: 10px; margin-top: auto;
    }

    /* Button Styles */
    .btn-green { background-color: #059669; color: white; padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; text-decoration: none; }
    .btn-green:hover { background-color: #065F46; }
    .btn-dark { background-color: #333; color: white; padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; }
    .btn-decline { background-color: #ef4444; color: white; padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; }
    .badge { padding: 4px 10px; border-radius: 99px; font-size: 0.75rem; font-weight: bold; text-transform: capitalize; }
    .badge.pending { background-color: #fef3c7; color: #92400e; }
    .badge.confirmed { background-color: #d1fae5; color: #065f46; }
    .badge.declined { background-color: #fee2e2; color: #991b1b; }
    .card-actions { margin-top: 1rem; display: flex; gap: 10px; }
</style>
{% endblock %}

{% block content %}
<main class="main-content">
    
    <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h1 style="font-size: 1.5rem; margin: 0;">Welcome, {{ designer.designer_name }}!</h1>
        <!-- <a href="{{ url_for('designer_profile') }}" class="view-all">Edit My Profile <i class='bx bx-edit'></i></a> -->
    </div>

    <div class="card">
        <h2>Performance Overview</h2>
        <div class="overview-grid">
            <div>
                <small>Total Projects</small>
                <h3>{{ total_projects }}</h3>
            </div>
            <div>
                <small>This Month's Bookings</small>
                <h3>{{ monthly_bookings }}</h3>
            </div>
            <div>
                <small>Average Rating</small>
                <h3>{{ avg_rating }} <span style="color: gold;">â˜…</span></h3>
                <small>({{ total_reviews }} reviews)</small>
            </div>
        </div>
    </div>

    <section class="recommendations-section" style="margin-top: 2rem;">
        <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 0.5rem;">
            <i class='bx bx-target-lock' style="color: #059669;"></i> AI Lead Recommendations
        </h2>
        <p style="color: #666; font-size: 0.95rem; margin-bottom: 1.5rem;">
            Matched based on your location ({{ designer.location }}) and style expertise.
        </p>
        
        <div class="leads-slider">
            {% for lead in recommended_leads %}
            <div class="lead-card">
                <div class="lead-header">
                    <div style="display:flex; gap:10px; align-items:center;">
                        <div class="lead-avatar">{{ lead.name[0] }}</div>
                        <div>
                            <h4 style="margin:0; font-size:1rem;">{{ lead.name }}</h4>
                            <small style="color:#6b7280;">{{ lead.location }}</small>
                        </div>
                    </div>
                    <div class="match-score">{{ lead.match_score }}% Match</div>
                </div>

                
                <button class="btn-green" style="width:100%; margin-top:15px;" onclick="alert('You can now message {{ lead.name }}!')">
                    Connect
                </button>
            </div>
            {% else %}
            <div class="card" style="width: 100%;">
                <p class="empty-placeholder">No matching leads found in your area right now. Try updating your location or styles.</p>
            </div>
            {% endfor %}
        </div>
    </section>


    <section class="portfolio-preview" style="margin-top: 2rem;">
        <h2>My Portfolio</h2>
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="margin: 0;">Latest Projects</h3>
                <a href="{{ url_for('add_project') }}" class="btn-green" style="text-decoration: none;">
                    <i class='bx bx-plus'></i> Add New Project
                </a>
            </div>
            <div class="portfolio-scroll-grid">
                {% for item in portfolio %}
                <div class="portfolio-item">
                    <img src="{{ item.image_url | default('https://placehold.co/300x200/eee/ccc?text=No+Image') }}" alt="{{ item.project_title }}">
                    <p>{{ item.project_title }}</p>
                    <small>{{ item.room_type }}</small>
                </div>
                {% else %}
                <p style="color:#6b7280;">No portfolio items uploaded yet.</p>
                {% endfor %}
            </div>
        </div>
    </section>

</main>
{% endblock %}